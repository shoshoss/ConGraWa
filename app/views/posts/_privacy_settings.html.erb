<%= turbo_frame_tag "privacy-settings" do %>
  <div id="privacy-settings" class="form-control pt-2">
    <% if local_assigns[:is_reply_form] %>
      <label for="post_privacy" class="block text-lg font-semibold">返信先</label>
      <div class="text-lg text-gray-500 mb-2">
        <% if local_assigns[:send_to_user].present? %>
          <%= link_to "@#{post.user.username_slug}さん", profile_modal_path(username_slug: post.user.username_slug),
              class: "text-xl font-semibold text-blue-500 hover:text-blue-700",
              data: { turbo_frame: "profile_modal" } %><br>
          <% post.ancestors.map(&:user).uniq.each do |user| %>
            <%= link_to "@#{user.username_slug}さん", profile_modal_path(username_slug: user.username_slug),
                class: "text-blue-500 hover:text-blue-700",
                data: { turbo_frame: "profile_modal" } %>
            <% unless user == post.ancestors.map(&:user).uniq.last %>、<% end %>
          <% end %>
        <% else %>
          <span>送信先の投稿が削除されました。</span>
        <% end %>
      </div>
      <input type="hidden" name="post[privacy]" id="post_privacy" value="reply">
    <% else %>
      <label for="post_privacy" class="block text-lg font-semibold">送信先</label>
      <div class="flex space-x-4 pt-2">
        <%= link_to '自分へ', new_post_path(privacy: 'only_me'), class: "c-button #{active_bottom('only_me')}", data: { turbo_frame: "_self" }, data: { turbo_frame: "privacy-settings" } %>
        <%= link_to 'みんなへ', new_post_path(privacy: 'open'), class: "c-button #{active_bottom('open')}", data: { turbo_frame: "_self" }, data: { turbo_frame: "privacy-settings" } %>
      </div>
      <input type="hidden" name="post[privacy]" id="post_privacy" value="<%= params[:privacy] || @post.privacy %>">
    <% end %>
  </div>
<% end %>
